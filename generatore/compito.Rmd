---
editor_options:
  chunk_output_type: console
date: " "
output:
  bookdown::pdf_document2:
    latex_engine: xelatex
    keep_tex: true
    toc: false
    includes:
      in_header: preamble.tex
    number_sections: false
  pdf_document:
    toc: false
    toc_depth: '6'
  html_document:
    css: sol.css
    toc: true
    toc_depth: 6
    toc_float:
      collapsed: false
      smooth_scroll: false
      df_print: paged
fontsize: 10pt
geometry: top=2cm,bottom=1.5cm,left=1.5cm,right=1.5cm
---

```{r setup, echo=FALSE}
html <- knitr::is_html_output()
if (html){
  knitr::opts_chunk$set(
    echo = FALSE,
    fig.height = 2.5*3,
    fig.width = 4*3,
    warning = FALSE,
    message = FALSE,
    results = 'asis'
  )
} else {
  knitr::opts_chunk$set(
    echo = FALSE,
    fig.height = 2.5,
    fig.width = 4,
    warning = FALSE,
    message = FALSE,
    results = 'asis',
    global.par = TRUE,
    fig.align = "center"
  )
  knitr::knit_hooks$set(
    par = function(before, options, envir) {
      if (before) par(cex = .5)
    }
  )
  par(cex=.5)
}
options(digits=4,nsmall=4,knitr.kable.NA = '',scipen = 1000000,dev.args = list(bg = 'transparent'))
library(knitr)
library(xtable)
library(kableExtra)
library(colorspace)
library(xaringan)
# solo generatore
library(pat.book)
# fine solo generatore
cex <- .8



anagrafica <- function(seed = NULL,new.page=F,cod.comp = NULL) { 
  if (!is.null(seed)) set.seed(seed)
  if (is.null(cod.comp)) cod.comp <- paste0(sample(c(0:9, LETTERS), 15), collapse = "")

  if (html) cat("# Prova di Statistica (CLEAM)\n\n")
  if (new.page)cat("\\newpage\n")
  cat("\\vspace*{-1.4cm}\n\\anagrafica{}\n\n")
  cat("\\thispagestyle{fancy}\n")
  cat("\\fancypagestyle{firstpage}{%\n")
  cat("  \\lhead{\\textbf{Prova di Statistica (CLEAM)}}\n") 
  cat(paste0("  \\rhead{\\texttt{", cod.comp, "}}\n"))
  cat("  \\cfoot{} % Rimuove il numero di pagina\n")
  cat("}\n")
  cat("\\pagestyle{firstpage}\n")
}
punti_p <- function(start=F,nex=F,num=F){
  tot <- sum(unlist(punti))
  it <- ifelse(start,item_start(num),item_(num))
  it <- ifelse(nex,item_next(num),it)
  ptt <- punti[[i1]][i2]
  ptt_30 <- format(round(ptt/tot*31,1),nsmall=1)
  sep <- ifelse(html," ","\\hspace{.1em}")
  if(html) paste(it,"(pt",sep,ptt,"/",tot," → ",ptt_30,"/31)",sep="") else paste(it,"(pt",sep,ptt_30,"/31)",sep="")
}

par(bg="transparent")
cod.comp <- function(x,i1 = 1, i2 = 13){ paste0(c(sample(c(0:9,LETTERS),i1),x,sample(c(0:9,LETTERS),i2)),collapse = "")}
```


<div class="button-container"></div>

```{r preparazione}
anagrafica(new.page = F,cod.comp = cod.comp(x = "",i2 = 14))
```


```{r setup-punti, echo=FALSE}
punti <- list(
   e1 = c(13, 4, 2, 2),
   e2 = c(13, 4, 2, 2),
   e3 = c(13),
   e4 = c(3, 3, 3, 3),
   e5 = c(3, 10),
   e6 = c(13, 4, 2, 2)
)
```



### Esercizio 1 




```{r 2024-71}

# Basic settings
set.seed(1)   # per ottenere sempre la stessa simulazione
n <- 250      # ampiezza campionaria

brk  <- c(0,1.5,3,8,20)
nnn  <- c( 200,100,80, 50)
nnn  <- round(nnn/sum(nnn)*n)
nomex <- "Investimento"

samp <- genera_dati(brk = brk,nnn=nnn,n=n)
  
ls2e(x = stat_base(samp,brk))
```

Su un campione di $`r n`$ famiglie dell'Emilia-Romagna sono stati rilevati i consumi annui in beni tecnologici (dati espressi in migliaia di euro). Qui di seguito la distribuzione delle frequenze cumulate:

```{r 2024-72}
kable(dat3[,c(1,2,7)],booktabs=T,escape = F,linesep="") %>%
  kable_styling(full_width = F, latex_options = "HOLD_position")

```

`r punti_p(start=T)`  Disegnare l'istogramma di densità percentuale. 

:::{.sol data-latex=""}
```{r 2024-73}
kable(dat3[,1:6],booktabs=T,escape = F,linesep="") %>%
  kable_styling(full_width = F, latex_options = "HOLD_position")

histp(T)
```
:::

`r punti_p()` Quante famiglie spendono meno di 5 mila euro all'anno? 

:::{.sol data-latex=""}
```{r 2024-74}
F_print(x = 5,verso = "<")
```
:::  


`r punti_p()` Che relazione dobbiamo aspettarci tra media,  mediana e moda? 

`r punti_p()` La spesa media è pari a $\bar x=`r mean(samp)`$, mentre la SD è pari a $SD=`r sd(samp)`$.
Se ogni famiglia spendesse 2 mila euro in più all'anno, quanto varrebbero la media e la SD dei dati trasformati?




### Esercizio 2 


Si consideri un'urna così formata,
$$
\left\{\fbox{1},\fbox{2},\fbox{3},\fbox{4},\fbox{5},\fbox{6},\fbox{7},\fbox{8}\right\}.
$$
Si vince se si estrae un numero maggiore o uguale a 6. 

Si estrae _con_ reintroduzione.

`r punti_p(nex = T)` Qual è la probabilità di vincere almeno 5 volte su 6 estrazioni?

::: {.sol data-latex=""}
Sia $X$ la VC che conta il numero di di vittorie in 6 giocate,
quindi $n=6$ replicazioni di una Bernoulli $X_i\sim\mbox{Ber}(\pi=3/8)$ e quindi

$$
X=X_1+...+X_n\sim\mbox{Binom}(n=6,\pi=`r 3/8`)
$$

la probabilità di avere almeno 5 bussolotti rossi su 6 estrazioni è


```{r 2021-19,,results='asis'}
pp <- .38
cat(bin_dis(5,6,pp = 3/8,verso = ">"))
```
:::

`r punti_p()` Calcolare la probabilità di vincere la prima volta alla quarta estrazione.

::: {.sol data-latex=""}
Ogni singola giocata $X_i$ è una Bernoulli $X_i\sim\mbox{Ber}(\pi=3/8)$ e quindi 
\begin{eqnarray*}
E&=&\text{Vincere la prima volta alla quarta estrazione}\\
 &=& X_1=0~\cap~X_2=0~\cap~X_3=0~\cap~X_4=1\\
P(E)&=&P(X_1=0~\cap~X_2=0~\cap~X_3=0~\cap~X_4=1)\\
&=&P(X_1=0)P(X_2=0)P(X_3=0)P(X_4=1)\\
&=&\left(1-\frac 38\right)\left(1-\frac 38\right)\left(1-\frac 38\right)\frac 38\\
&=&\left(\frac 58\right)^3\frac 38\\
&=&`r (5/8)^3*3/8 `
\end{eqnarray*}
:::

`r punti_p()` Se $A$ e $B$ sono due eventi tali che, $P(A)>0$, $P(B)>0$, $P(A\cap B)=0$. 
$A$ e $B$ possono essere indipendenti?

::: {.sol data-latex=""}
No, in quanto, se $A$ e $B$ sono indipendenti
$$P(A\cap B)=P(A)P(B)\neq0$$
:::

`r punti_p()` Sia $X\sim N(3.2,(1.1)^2)$ e sia $Y\sim\chi_{n-1}^2$, posto
$$
T=\frac{\left(\frac{X-3.2}{1.1}\right)}{\sqrt{\frac{Y}{n-1}}},
$$
come si distribuisce $T$?

::: {.sol data-latex=""}
Si noti che
$$
Z=\left(\frac{X-3.2}{1.1}\right)\sim N(0,1)
$$
e che
$$
T=\frac{Z}{\sqrt{\frac{Y}{n-1}}}\sim t_{n-1}
$$
:::






### Esercizio 3 


```{r 2022-106}
n <- 60
ex <- 3.242
vx <- 0.5^2
es <- mm <- ex*n
vs <- ss <- vx*n
#ss <- sqrt(vs)
# 
 # curve(dnorm(x,es,sqrt(ss)),from = es-4*sqrt(ss),to = es+4*sqrt(ss),axes=F)
 # axis(1)
 # curve(dnorm(x,es,sqrt(ss)),from = 30,to = es+4*sqrt(ss),add=T,type = "h",n=101)
vnam<- "S_n"
mu <- "E(S_n)"
sigma <- "SD(S_n)"
x1 <- 225
verso <- ">"
```

`r punti_p(nex = T)` Il supermercato _S_ accoglie, in media ogni giorno, 3.242 mila persone, con una
deviazione standard di 0.5 mila persone. Dopo 60 giorni di apertura, qual è la probabilità che il 
totale dei visitatori sia maggiore di 225 mila persone?

```{r 2022-107}
tlc("somma",225,verso = ">",mu = ex,s2 = vx,n = n)
```







### Esercizio 4 


  
`r punti_p(nex = T)` Siano $\hat \mu$ e $\hat\sigma^2$ gli stimatori di massima verosimiglianza di $\mu$ e $\sigma^2$ del modello di Normale.
\begin{eqnarray*}
  \hat\mu &=&  \frac 1n\sum_{i=1}^nx_i \qquad \hat\sigma^2 =  \frac 1n\sum_{i=1}^n(x_i-\hat\mu)^2\\
\end{eqnarray*}
Dimostrare la consistenza di $\hat\mu$.

`r punti_p()` Cosa significa che gli stimatori di massima verosimiglianza sono invarianti alle trasformazioni monotone invertibili?

`r punti_p()` Definire la significatività di un test.

```{r 2023-205}
tabella <- matrix(c(50, 120, 50, 60, 80, 40, 40, 50, 50), nrow = 3, ncol = 3, byrow = TRUE)
n <- sum(tabella)
pval <- format(chisq.test(tabella)$p.value,digits = 4,nsmall = 4)
```

`r punti_p()` Un sociologo sta conducendo uno studio sull'associazione tra l'orientamento politico e l'atteggiamento nei confronti del cambiamento climatico. Ha somministrato un questionario a `r n` partecipanti, chiedendo loro di indicare il proprio orientamento politico (Conservatore, Progressista, Indipendente) e l'atteggiamento nei confronti del cambiamento climatico (Molto, poco, per nulla) preoccupato. L'obiettivo è determinare se c'è un'associazione significativa tra l'orientamento politico e l'atteggiamento nei confronti del cambiamento climatico.

```{r 2023-206}

# Assegnazione dei nomi alle righe e alle colonne
rownames(tabella) <- c("Conservatore", "Progressista", "Indipendente")
colnames(tabella) <- c("Molto", "Poco", "Per nulla")


 tabl(tabella)  %>%
   kable_styling(full_width = F)  %>%
   kable_paper(full_width = F)  %>%
   pack_rows("Orientamento politico", 1, 3) %>%
   add_header_above(c(" " = 1, "Preoccupato per i cambiamenti climatici" = 3))
```
Eseguito il test del $\chi^2$ per verificare l'indipendenza tra l'orientamento politico e la preoccupazione
sui cambiamenti climatici il sociologo ottiene un $p_\text{value}=`r pval`$. Quali conclusioni può trarne?






### Esercizio 5 


```{r 2023-159}
n1 <- 35
muh <- 68
sdh <- 5
mu0 <- 71
```

`r punti_p(nex = T)` In uno studio sui redditi, nel comune $A$ si è rilevato il reddito di $n=`r n1`$ individui e si è osservata una media pari $`r muh`$ mila euro con una standard deviation pari a $`r sdh`$ mila euro.
Costruire un intervallo di confidenza al 95% per il reddito medio $\mu$.

:::{.sol data-latex=""}
```{r 2023-28,,results='asis'}
options(digits = 4)
res <- idc(xm = muh,sd = sdh,alpha = .05,n = n1,dist_ = "t",mus = mu0,ss = "S")
cat(res)
```
:::

`r punti_p()` Un'indagine analoga, svolta sull'intera regione, ha mostrato un reddito medio pari a $\mu_0=`r mu0`$. Testare l'ipotesi che nel comune $A$ il reddito medio sia uguale a quello regionale contro l'alternativa che sia __diverso__.

:::{.sol data-latex=""}
```{r 2023-29,,results='asis'}
res <- ttest_mu(muh = muh,sh = sdh,n = n1,mu0 = mu0,h1 = "\\neq")
cat(res)
```
:::






### Esercizio 6 


```{r 2022-62}

set.seed(36)
n <- 50
x <- sort(sample(seq(10,20,by=.1),n))

eps <- rnorm(n,0,3)
y <- -5+x + eps

RGX <-regr(x,y)
ls2e(RGX)
```

Sono stati analizzati `r n` comuni della provincia di Modena e su ogni comune è stato rilevato
il numero di abitanti $X$, espresso in migliaia di persone, e il numero di esercizi commerciali $Y$.

Qui di seguito le statistiche bivariate

\begin{align*}
  \sum_{i=1}^n x_i &= `r sum(x)` &\sum_{i=1}^n x_i^2 &= `r sum(x^2)` &\sum_{i=1}^n x_i y_i &= `r sum(x*y)`\\
  \sum_{i=1}^n y_i &= `r sum(y)` & \sum_{i=1}^n y_i^2 &= `r sum(y^2)` &
\end{align*}

`r punti_p(nex = T)` Stimare la previsione per $x=16$ nel modello di regressione dove $Y$ viene spiegata da $X$.

:::{.sol data-latex=""}
```{r 2022-63}
cat(calcolo_beta())
cat(previsione(16))
```
:::


`r punti_p()` Il modello si adatta bene ai dati?

$$r^2=`r r^2`$$

`r punti_p()` Cosa sono i _punti influenti_?

`r punti_p()` Se $W=2\times Y$ e $V=X+3$, posto $w_i=\beta_0'+\beta_1'v_ì +\epsilon_i'$
il modello in cui $W$ viene spiegata da $V$, quanto varranno $\beta_0'$ e $\beta_1'$?

:::{.sol data-latex=""}
\begin{eqnarray*}
   \hat\beta_1' &=&  r_{VW}\frac{\sigma_W}{\sigma_V} \\
            &=&  r_{XY}\frac{2\sigma_Y}{\sigma_X} \\
            &=& 2\hat\beta_1\\
            &=& `r b1*22`\\
  \hat\beta_0' &=& \bar w - \hat\beta_1'\bar v\\
            &=& 2\bar y-2\hat\beta_1(\bar x + 3)\\
            &=& `r 2*mean(y)-b1*2*(mean(x)+3)`
\end{eqnarray*}
:::



<div class="button-container"></div>


